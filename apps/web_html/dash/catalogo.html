<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Catálogo</title>
    <link rel="stylesheet" href="/src/style.css" />
    <script src="https://unpkg.com/htmx.org@1.9.12" defer></script>
  </head>
  <body class="min-h-screen">
    <div class="mx-auto max-w-6xl px-6 py-8 space-y-6">
      <div hx-get="/partials/navbar.html" hx-trigger="load" hx-swap="outerHTML"></div>
      <h1 class="text-2xl font-semibold">Catálogo B2B</h1>
      <section class="card">
        <h2 class="text-lg font-semibold mb-3">Filtrar</h2>
        <form class="grid md:grid-cols-3 gap-2" onsubmit="event.preventDefault(); loadCatalog();">
          <input id="f_marca" class="input" placeholder="marca" />
          <input id="f_potencia" class="input" placeholder="potencia (W)" />
          <input id="f_stock" class="input" placeholder=">= stock" />
          <button class="btn-primary" type="submit">Buscar</button>
        </form>
      </section>
      <section class="grid md:grid-cols-3 gap-4" id="grid">Cargando...</section>
    </div>
    <script>
      const API = 'http://localhost:8001';
      async function loadCatalog(){
        const params = new URLSearchParams();
        if (f_marca.value) params.append('marca', f_marca.value);
        if (f_potencia.value) params.append('potencia', f_potencia.value);
        if (f_stock.value) params.append('stock', f_stock.value);
        const res = await fetch(`${API}/api/products/?${params.toString()}`);
        let data = await res.json();
        if (!Array.isArray(data) && data?.value) data = data.value;
        if (!Array.isArray(data)) data = [];
        grid.innerHTML = data.map(p => `
          <div class="card">
            <div class="text-xl font-semibold mb-1">${p.sku}</div>
            <div class="text-sm text-[color:var(--text-secondary)]">Precio: $${p.precio} • Stock: ${p.stock}</div>
            <form class="mt-3" hx-post="${API}/api/order" hx-target="#grid" hx-swap="none">
              <input type="hidden" name="producto" value="${p.id}" />
              <input name="cantidad" class="input" type="number" min="1" value="1" />
              <button class="btn-primary">Ordenar</button>
            </form>
          </div>`).join('');
      }
      loadCatalog();
    </script>
  </body>
  </html>




